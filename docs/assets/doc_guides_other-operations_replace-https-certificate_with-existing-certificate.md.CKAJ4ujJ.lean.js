import{_ as e,c as i,a2 as a,o as t}from"./chunks/framework.BQmytedh.js";const n="/assets/Correct_https_certificate.0fdhkxlU.png",g=JSON.parse('{"title":"Associate an existing certificate","description":"","frontmatter":{"prev":{"text":"Replace HTTPS certificate","link":"/doc/guides/other-operations/replace-https-certificate"},"next":{"text":"Purchase a new certificate form a CA","link":"/doc/guides/other-operations/replace-https-certificate/purchase-new-ca-certificate"}},"headers":[],"relativePath":"doc/guides/other-operations/replace-https-certificate/with-existing-certificate.md","filePath":"doc/guides/other-operations/replace-https-certificate/with-existing-certificate.md"}'),l={name:"doc/guides/other-operations/replace-https-certificate/with-existing-certificate.md"};function p(h,s,c,r,o,d){return t(),i("div",null,s[0]||(s[0]=[a(`<h1 id="associate-an-existing-certificate" tabindex="-1">Associate an existing certificate <a class="header-anchor" href="#associate-an-existing-certificate" aria-label="Permalink to &quot;Associate an existing certificate&quot;">​</a></h1><h2 id="requirements" tabindex="-1">Requirements <a class="header-anchor" href="#requirements" aria-label="Permalink to &quot;Requirements&quot;">​</a></h2><p>The <em>openssl</em> software package needs to be installed in your system and inside the <em>$PATH</em> variable (login with the same user account that runs the ioChem-BD software and try to execute <em>openssl version</em> command to check its properly installed).</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iochembd$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   openssl version</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OpenSSL 1.0.2h  3 May 2016 </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (or </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">another</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>The update process also needs these certificate files:</p><ul><li>The <strong>public</strong> certificate file,</li><li>the certificate <strong>private</strong> key file and</li><li>a file with the <strong>intermediate</strong> certificates (optional)</li></ul><p>Now we will detail the file names and the format of every file enumerated previously.<br> The file with the public certificate must be encoded on <strong>X.509 PEM</strong> format and with extension <strong>.crt</strong>. Example:</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-----BEGIN CERTIFICATE-----</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MIIE/zCCBGgCAg4CMA0GCSqGSIb3DQEBBQUAMIGbMQswCQYDVQQGEwJKUDEOMAwG</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">A1UECBMFVG9reW8xEDAOBgNVBAcTB0NodW8ta3UxETAPBgNVBAoTCEZyYW5rNERE    </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3V1dbLU5id63lVD8sUEULyfWFGk3L+Uka5oiSsxwZhdIb/Q=</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-----END CERTIFICATE----</span></span></code></pre></div><p>The file with the private certificate must be encoded on <strong>unencrypted PKCS#8 PEM</strong> format and with extension <strong>.key</strong>. Example:</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-----BEGIN PRIVATE KEY-----</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MHcCAQEEIBdVHnnzZmJm+Z1HAYYOZlvnB8Dj8kVx9XBH+6UCWlGUoAoGCCqGSM49</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AwEHoUQDQgAEThPp/xgEov0mKg2s0GII76VkZAcCc//3quAqzg+PuFKXgruaF7K</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-----END PRIVATE KEY-----</span></span></code></pre></div><p>Under some circumstances the certificate also has some intermediate certificates that contain its upper level certificates (the ones that the certificate trusts). In this special case you must concatenate all that certificates into a single file on <strong>X509 PEM</strong> format , ordered from them most local to most global and must have <strong>.bundle</strong> extension. Example file content with three intermediate certificates:</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-----BEGIN CERTIFICATE-----</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">....</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-----END CERTIFICATE-----</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-----BEGIN CERTIFICATE-----</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">....</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-----END CERTIFICATE-----</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-----BEGIN CERTIFICATE-----</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">....</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-----END CERTIFICATE-----</span></span></code></pre></div><hr><p>Final checks: To ensure our certification chain is valid before we update ioChem-BD certificates, we will run the following command:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iochembd$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> verify</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -CAfile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> additional.bundle</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  certificate.crt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">certificate.crt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> OK</span></span></code></pre></div><p>Any different response from previous command except OK should be analyzed and it&#39;s not advised to continue this certificate update procedure until the certification chain is totally valid.</p><h2 id="update-process" tabindex="-1">Update process <a class="header-anchor" href="#update-process" aria-label="Permalink to &quot;Update process&quot;">​</a></h2><p>From now on we will talk about <em>BASE_PATH</em> when we refer to the path where the software has been installed, please replace it for the real full path</p><p>We will run the update process with the same user account that runs the software (in this case <em>iochembd</em>), all previous certificate files must also be owned by this user.</p><p>We will initially stop the web service:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iochembd$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  BASE_PATH/apache-tomcat/bin/shutdown.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -force</span></span></code></pre></div><p>Once the service has stopped, we will copy copy all certificate files inside <em>BASE_PATH/ssl/new</em> folder:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iochembd$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> certificate.crt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    BASE_PATH/ssl/new</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #Only file extensions are fixed, filenames can be arbitrary </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iochembd$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> certificate.key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    BASE_PATH/ssl/new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iochembd$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> additional.bundle</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  BASE_PATH/ssl/new</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #Optional file</span></span></code></pre></div><p>With the requested files inside the ssl folder, we will launch the tool that replaces self-signed certificates for the new ones.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iochembd$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> BASE_PATH/updates</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iochembd$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ./updater.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ReplaceDomainCertificate</span></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">DANGER</p><p>If you get an error retrieving the patch files similar to this one:</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Error retrieving patch files on http://www.iochem-bd.org/conversion/updates/ReplaceDomainCertificate/update.tar.gz!</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Please contact ioChem-BD development team at: contact@iochem-bd.org</span></span></code></pre></div><p>Please replace the update script <em>updater.sh</em> with the latest version from:<br> <a href="https://www.iochem-bd.org/update/updater.sh" target="_blank" rel="noreferrer">https://www.iochem-bd.org/update/updater.sh</a>.</p></div><p>The output of this patch will enumerate all steps performed and which files are backed up and replaced:</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16:13:40 [main] INFO  utils.Utils - Running command:[/bin/pgrep, -a, -f, tomcat]</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16:13:40 [main] INFO  update.UpdatePatch -      Running update vxxx.ReplaceDomainCertificate</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16:13:40 [main] INFO  update.UpdatePatch - Generating pkcs12 certificate file from certs + key</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16:13:40 [main] INFO  utils.Utils - Running command:[openssl, pkcs12, -export, -in, /home/user/iochem-bd/ssl/new/cert.crt, -inkey, /home/user/iochem-bd/ssl/new/cert.key, -out, /home/user/iochem-bd/ssl/new/certificate.p12, -name, iochem-bd, -chain, -CAfile, /home/user/iochem-bd/ssl/new/cert.bundle, -caname, root, -passin, pass:changeit, -passout, pass:changeit]</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16:13:40 [main] INFO  update.UpdatePatch - Generating keystore from pkcs12 certificate</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16:13:40 [main] INFO  utils.Utils - Running command:[keytool, -importkeystore, -deststorepass, changeit, -destkeypass, changeit, -destkeystore, /home/user/iochem-bd/ssl/new/keystore.jks, -srckeystore, /home/user/iochem-bd/ssl/new/certificate.p12, -srcstoretype, PKCS12, -srcstorepass, changeit, -alias, iochem-bd]</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16:13:40 [main] INFO  update.UpdatePatch - Replacing keystore with the newly generated one.</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16:13:40 [main] INFO  update.UpdatePatch - </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">End update successfully</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16:13:40 [main] INFO  update.UpdateProcess - ioChem-BD updated with patch ReplaceDomainCertificate.</span></span></code></pre></div><p>If the result of the update process is successful, we can start the service.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iochembd$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    BASE_PATH/apache-tomcat/bin/startup.sh</span></span></code></pre></div><p>Once started, we can check that the ioChem-BD service is running with a valid HTTPS certificate, green lock indicates a valid certificate.</p><p><img src="`+n+'" alt="Green lock on navigation bar"></p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>If an exception raises during the certification replacement process, you can undo the entire process by <a href="./undo-certificate-replacement.html">restoring previous certificates</a> and contact <a href="mailto:contact@iochem-bd.org" target="_blank" rel="noreferrer">contact@iochem-bd.org</a> reporting your errors</p></div>',33)]))}const u=e(l,[["render",p]]);export{g as __pageData,u as default};
